{{ define "main" }}
  <article class='h-entry'>
    {{- partialCached "post/header" (dict "Listing" false "Page" .) .Permalink false -}}
    {{- partialCached "post/content" . .Permalink }}

    {{ if eq hugo.Environment "eagle" }}
    <div style='clear: both; text-align: center;'>
      <a href='#guestbook-form'><button>📝 Sign Guestbook </button></a>
    </div>
    {{ end }}

    {{ with .Resources.Get "sidecar.json" | unmarshal -}}
      <div class="entries">
        {{- range .replies }}
          <div class="entry">
            <p>
              <strong>From</strong>:
                {{ with .authorUrl }}<a rel="noopener noreferrer" href="{{ . }}">{{ end }}
                {{- with .author }}{{ . }}{{ else }}Anonymous{{ end -}}
                {{- with .authorUrl }}</a>{{ end -}}
              <br>
              <strong>Date</strong>: {{ dateFormat "2006-01-02" .date }}
            </p>

            {{  .content | $.RenderString (dict "display" "block") }}
          </div>
        {{ end -}}
      </div>
    {{ end -}}
  </article>

  {{ if eq hugo.Environment "eagle" }}
  <form method='post' id="guestbook-form" action='/comments' class='box'>
    <label for='gb-name'>Your Name<abbr title="required">*</abbr></label>
    <input required type='text' maxlength='200' id='gb-name' name='name' placeholder='Mary Jane' value='' />

    <label for='gb-website'>Your Website</label>
    <input type='url' maxlength='200' id='gb-website' name='website' placeholder='https://example.com' value='' />

    <label for='gb-content'>Your Message<abbr title="required">*</abbr></label>
    <textarea required maxlength='1000' rows='7' id='gb-content' name='content' placeholder='Type your message, *markdown* is allowed...'></textarea>

    <label for='gb-captcha'>
      Anti-bot validation 🙃<br>
      <small>
        Unfortunately, spam is becoming increasingly harder to prevent.
        If you're human, please type down my most commonly seen <a href="/about/#handle">@handle</a>,
        which is also part of the domain name of this website.
      </small>
    </label>
    <input type='text' maxlength='100' id='gb-captcha' name='captcha' placeholder='hac...' />

    <input type='text' maxlength='300' name='target' value='/guestbook/' class='dn' hidden />
    <button>Sign Guestbook</button>
  </form>
  {{ end }}
{{ end }}
